<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YEAH WEBSOCKETS BITCH</title>

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css"/>
    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1>Hello.</h1>

            <form>
                <h2>What's your name?</h2>
                <div class="form-group">
                    <input type="text" class="form-control input-lg" id="name"/>
                </div>

                <h2>Say something.</h2>
                <div class="form-group">
                    <input type="text" class="form-control input-lg" id="msg"/>
                </div>

                <p>
                    <input type="submit" class="btn btn-primary btn-lg btn-block" id="send"></input>
                </p>

                <div class="panel panel-primary" id="chat">
                    <div class="panel-heading">This is the chat.</div>
                    <ul class="list-group">
                        <li class="list-group-item" id="nothing">But there's nothing here yet.</li>
                    </ul>
                </div>
            </form>
        </div>
    </div>

</div>


<script>
    var updateTimestamps = function(){
        $('.timestamp').each(function(i, el){
            var $el = $(el);
            $el.text(moment($el.data('timestamp')).fromNow());
        })
    };

    setInterval(updateTimestamps, 1000);

    var socket = io.connect(window.location.origin.split(':').slice(0, 2).join(':'));

    var $lg = $('.list-group');
    var $nothing = $('#nothing');

    socket.on('broadcast-message', function(data){
        var timestamp = +new Date();
        $nothing.remove();
        $lg.prepend($('<li class="list-group-item"><strong>' + data.name + '</strong>: ' + data.msg + '<em class="pull-right timestamp" data-timestamp="' + timestamp + '"></em></li>'));
        updateTimestamps()
    });

    $('form').on('submit', function(){
        var data = {
            name: $('#name').val(),
            msg: $('#msg').val()
        }
        socket.emit('send-message', data);
        return false;
    });
</script>

</body>
</html>